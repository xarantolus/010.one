!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.yamz=factory()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var __assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},Classes,STATES;function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}function __generator(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}}function generateLightboxImg($img,newSrc){var $newImg=document.createElement("img"),src=newSrc||getSrcFromImage($img);return $newImg.src=src,$newImg}function isValidImage($elm){var types;return[HTMLPictureElement,HTMLImageElement].some((function(type){return $elm instanceof type}))}function getHighResFromImage($image,targetWidth){void 0===targetWidth&&(targetWidth=document.body.clientWidth);var cur={width:$image.offsetWidth,src:getSrcFromImage($image)},$targets;return($image instanceof HTMLImageElement?[$image]:Array.from($image.querySelectorAll("source"))).forEach((function($target){if((!($target instanceof HTMLSourceElement&&$target.media)||matchMedia($target.media).matches)&&$target.srcset){var srcset,parsed=getHighestFromSrcSet($target.srcset,targetWidth);parsed&&parsed.width>cur.width&&(cur=parsed)}})),cur.src}function getHighestFromSrcSet(srcset,targetWidth){var parsed;return void 0===targetWidth&&(targetWidth=document.body.clientWidth),srcset.split(",").map((function(entry){var widthMatch=/([^ ]+) +(\d+)w$/.exec(entry.trim());return widthMatch?{src:widthMatch[1],width:+widthMatch[2]}:null})).reduce((function(prev,entry){return entry?prev?entry.width>prev.width&&prev.width>=targetWidth?prev:entry.width<prev.width&&entry.width<targetWidth?prev:entry:entry:prev}),null)}function getSrcFromImage($elm){if($elm instanceof HTMLImageElement)return $elm.currentSrc||$elm.src;if($elm instanceof HTMLPictureElement){var $img=$elm.querySelector("img");if($img)return $img.currentSrc||$img.src}return""}function getScrollPosition(horizontal){return void 0===horizontal&&(horizontal=!1),horizontal?window.scrollX||document.body.scrollLeft||document.documentElement.scrollLeft||0:window.scrollY||document.body.scrollTop||document.documentElement.scrollTop||0}function defaultLightboxGenerator($copiedImg,opts,$original){var $wrapper=document.createElement("aside");$wrapper.classList.add(Classes.WRAPPER),opts.class&&$wrapper.classList.add(opts.class);var $imgWrapper=document.createElement("div");if($imgWrapper.classList.add(Classes.IMG_WRAPPER),$imgWrapper.appendChild($copiedImg),$wrapper.appendChild($imgWrapper),opts.highres){$wrapper.classList.add(Classes.HAS_HIGHRES);var $loader=document.createElement("div");$loader.classList.add(Classes.LOADER),$imgWrapper.insertBefore($loader,$copiedImg)}return $wrapper}!function(Classes){Classes.WRAPPER="yamz__wrapper",Classes.WRAPPER_CLOSING="yamz__wrapper--closing",Classes.IMG_WRAPPER="yamz__img-wrapper",Classes.IMG="yamz__img",Classes.HIGHRES="yamz__highres",Classes.HAS_HIGHRES="yamz__wrapper--has-highres",Classes.HIGHRES_LOADED="yamz__wrapper--highres-loaded",Classes.CAPTION="yamz__caption",Classes.HAS_CAPTION="yamz__wrapper--has-caption",Classes.ORIGINAL="yamz__original",Classes.ORIGINAL_OPEN="yamz__original--open",Classes.LOADER="yamz__loader",Classes.ALBUM_PREV="yamz__album__prev",Classes.ALBUM_NEXT="yamz__album__next"}(Classes||(Classes={})),function(STATES){STATES[STATES.Closed=0]="Closed",STATES[STATES.Opening=1]="Opening",STATES[STATES.Open=2]="Open",STATES[STATES.Closing=3]="Closing"}(STATES||(STATES={}));var elmMap=new Map,FLIPElement=function(){function FLIPElement($elm){if(this.playing=!1,this.$elm=$elm,elmMap.has($elm)){var self_1=elmMap.get($elm);if(self_1)return self_1}elmMap.set($elm,this),this._onTransitionEnd=this._onTransitionEnd.bind(this),this.stop=this.stop.bind(this)}return FLIPElement.prototype.first=function($elm){return void 0===$elm&&($elm=this.$elm),this.playing&&this.stop(),this._first=getSnapshot($elm),this},FLIPElement.prototype.last=function($elm){return void 0===$elm&&($elm=this.$elm),this.playing&&this.stop(),this._last=getSnapshot($elm),this},FLIPElement.prototype.invert=function($elm){if(void 0===$elm&&($elm=this.$elm),!this._first||!this._last)throw new Error(".first() and .last() must be called before .invert()");return this._elmPos=getSnapshot($elm),$elm.style.transitionDuration="0s",$elm.style.transformOrigin="50% 50%",$elm.style.transform=getTransform(this._elmPos,this._first),this._target$Elm=$elm,this},FLIPElement.prototype.play=function(duration){var _this=this;if(void 0===duration&&(duration=300),!(this._target$Elm&&this._elmPos&&this._first&&this._last))throw new Error(".invert() must be called before .play()");this.playing&&this.stop(),this.playing=!0;var $elm=this._target$Elm;return $elm.offsetHeight,$elm.style.transitionDuration=duration+"ms",$elm.style.transform=getTransform(this._elmPos,this._last),$elm.addEventListener("transitioncancel",this._onTransitionEnd),$elm.addEventListener("transitionend",this._onTransitionEnd),clearTimeout(this._transitionFallback),this._transitionFallback=setTimeout(this.stop,duration+50),new Promise((function(res,rej){_this._playResolver=res}))},FLIPElement.prototype.stop=function(){clearTimeout(this._transitionFallback),this._target$Elm&&(this._target$Elm.removeEventListener("transitioncancel",this._onTransitionEnd),this._target$Elm.removeEventListener("transitionend",this._onTransitionEnd)),this._playResolver&&(this._playResolver(),this._playResolver=void 0),this.playing=!1,this._target$Elm=void 0},FLIPElement.prototype.update=function($target,updater,duration){var $elm=this._target$Elm;if(this.playing&&$elm&&this._first){var currentPos=getTransformedSnapshot($elm);updater&&updater(),this._elmPos=getSnapshot($elm),this._last=getSnapshot($target);var prevDuration=duration?duration+"ms":$elm.style.transitionDuration;$elm.style.transitionDuration="0ms",$elm.style.transform=getTransform(this._elmPos,currentPos),$elm.offsetHeight,$elm.style.transitionDuration=prevDuration,$elm.style.transform=getTransform(this._elmPos,this._last)}},FLIPElement.prototype._onTransitionEnd=function(e){e.target===this._target$Elm&&"transform"===e.propertyName&&this.stop()},FLIPElement}(),css;function getSnapshot($elm){var outp={width:$elm.offsetWidth,height:$elm.offsetHeight,left:$elm.offsetLeft,top:$elm.offsetTop};for(outp.left+=outp.width/2,outp.top+=outp.height/2;$elm.offsetParent instanceof HTMLElement&&$elm.offsetParent&&$elm.offsetParent!==document.body&&$elm.offsetParent!==document.documentElement;)$elm=$elm.offsetParent,outp.left+=$elm.offsetLeft,outp.top+=$elm.offsetTop;if(0===$elm.offsetTop&&0===$elm.offsetLeft&&"fixed"===window.getComputedStyle($elm).position){var $doc=document.documentElement;outp.left+=getScrollPosition(!0)-($doc.clientLeft||0),outp.top+=getScrollPosition()-($doc.clientTop||0)}return outp}function getTransformedSnapshot($elm){var boundingRect=$elm.getBoundingClientRect(),$doc=document.documentElement,outp={left:Math.round(boundingRect.left)+getScrollPosition(!0)-($doc.clientLeft||0),top:Math.round(boundingRect.top)+getScrollPosition()-($doc.clientTop||0),width:Math.round(boundingRect.width),height:Math.round(boundingRect.height)};return outp.left+=outp.width/2,outp.top+=outp.height/2,outp}function getTransform(from,to){var delta={left:to.left-from.left,top:to.top-from.top,width:to.width/from.width,height:to.height/from.height},translation,scaling;return"translate("+delta.left.toFixed(5)+"px, "+delta.top.toFixed(5)+"px)"+" "+("scale("+delta.width.toFixed(5)+", "+delta.height.toFixed(5)+")")}function styleInject(css,ref){void 0===ref&&(ref={});var insertAt=ref.insertAt;if(css&&"undefined"!=typeof document){var head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css","top"===insertAt&&head.firstChild?head.insertBefore(style,head.firstChild):head.appendChild(style),style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css))}}styleInject('/* original */\n.yamz__original {\n    cursor: zoom-in;\n}\n.yamz__original--open {\n    visibility: hidden;\n}\n\n/* wrapper */\n.yamz__wrapper {\n    position: absolute;\n    left: 0;\n    width: 100%;\n    height: 100vh;\n    overflow-x: hidden;\n\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n\n    z-index: 999;\n    font-size: 16px;\n    color: #fff;\n    cursor: zoom-out;\n}\n.yamz__wrapper::before {\n    content: "";\n    position: fixed;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    z-index: -1;\n\n    background: rgba(0, 0, 0, 0.9);\n    animation: yamz-fade-in 0.2s ease-out both;\n}\n.yamz__wrapper--closing::before {\n    animation: yamz-fade-out 0.2s ease-out both;\n}\n@keyframes yamz-fade-in {\n    0% {\n        opacity: 0;\n    }\n    100% {\n        opacity: 1;\n    }\n}\n@keyframes yamz-fade-out {\n    0% {\n        opacity: 1;\n    }\n    100% {\n        opacity: 0;\n    }\n}\n\n/* img */\n.yamz__img-wrapper {\n    margin: 32px;\n    display: inline-block;\n    position: relative;\n    will-change: transform;\n    transition: transform ease;\n    animation: yamz-shadow-in 5s both;\n}\n@keyframes yamz-shadow-in {\n    0% {\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0);\n    }\n    100% {\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);\n    }\n}\n.yamz__wrapper--highres-loaded .yamz__img {\n    pointer-events: none;\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    z-index: -1;\n}\n.yamz__highres {\n    animation: yamz-fade-in 0.2s;\n    transition: opacity 0.2s;\n    opacity: 1;\n    will-change: opacity;\n}\n.yamz__wrapper--closing .yamz__highres {\n    opacity: 0;\n}\n@keyframes yamz-fade-in {\n    0% {\n        opacity: 0;\n    }\n}\n\n.yamz__img-wrapper > img {\n    max-width: calc(100vw - 64px);\n    max-height: calc(100vh - 64px);\n    margin: 0 auto;\n}\n\n/* loader */\n.yamz__loader {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    animation: yamz-fade-in 0.2s ease-out 0.1s both;\n}\n.yamz__wrapper--highres-loaded .yamz__loader {\n    z-index: -1;\n}\n.yamz__loader::before {\n    content: "";\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    width: 64px;\n    height: 64px;\n    background: #fff;\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    animation: yamz-loader 1s infinite ease;\n}\n@keyframes yamz-loader {\n    0% {\n        transform: translate(-50%, -50%) scale(0);\n        opacity: 1;\n    }\n    100% {\n        transform: translate(-50%, -50%) scale(1);\n        opacity: 0;\n    }\n}\n');var DEFAULT_OPTS={scrollAllowance:128,duration:300,container:void 0,lightboxGenerator:void 0},MediumLightboxCore,yamz=new(function(){function MediumLightboxCore(){this.options=__assign({},DEFAULT_OPTS),this.state=STATES.Closed,this.active=void 0,this._raf=!1,this.defaultLightboxGenerator=defaultLightboxGenerator,this._onScroll=this._onScroll.bind(this),this._onKeyDown=this._onKeyDown.bind(this)}return MediumLightboxCore.prototype.setOptions=function(newOpts){this.options=__assign({},this.options,newOpts)},MediumLightboxCore.prototype.getOptions=function(){return this.options},MediumLightboxCore.prototype.open=function($img,opts){return __awaiter(this,void 0,void 0,(function(){var options,$animElm,$positionElm;return __generator(this,(function(_a){switch(_a.label){case 0:if(!isValidImage($img))throw new TypeError($img+" cannot be used as an image");return this.active?[4,this.close()]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return options=__assign({},this.options,$img.yamzOpts||{},opts||{}),this.state=STATES.Opening,this.active=__assign({},this.generateLightbox($img,options),{options:options,scrollPos:getScrollPosition()}),(options.container||document.body).appendChild(this.active.$lightbox),this.active.$lightbox.style.top=this.active.scrollPos+"px",$animElm=this.active.$copiedImg.parentElement||this.active.$copiedImg,($positionElm="PICTURE"===$img.nodeName?$img.querySelector("img"):$img)||($positionElm=$img),options.duration>0?(this._flip=new FLIPElement($img),[4,this._flip.first($positionElm).last(this.active.$copiedImg).invert($animElm).play(options.duration)]):[3,4];case 3:_a.sent(),_a.label=4;case 4:return this.state=STATES.Open,this.attachListeners(),[2,this.active.$lightbox]}}))}))},MediumLightboxCore.prototype.close=function($img){return __awaiter(this,void 0,void 0,(function(){var active,options,$animElm,$positionElm,flip,$parent;return __generator(this,(function(_a){switch(_a.label){case 0:return this.active?$img&&this.active.$img!==$img?[2]:($img||($img=this.active.$img),this.detachListeners(),this.state=STATES.Closing,active=this.active,options=active.options,this.active.$lightbox.classList.add(Classes.WRAPPER_CLOSING),$animElm=this.active.$copiedImg.parentElement||this.active.$copiedImg,($positionElm="PICTURE"===this.active.$img.nodeName?this.active.$img.querySelector("img"):$img)||($positionElm=this.active.$img),options.duration?((flip=new FLIPElement($img)).first(this.active.$copiedImg).last($positionElm),[4,flip.invert($animElm).play(options.duration)]):[3,2]):[2];case 1:_a.sent(),_a.label=2;case 2:return active.$img.classList.remove(Classes.ORIGINAL_OPEN),($parent=active.$lightbox.parentNode)&&$parent.removeChild(active.$lightbox),this.state=STATES.Closed,this.active===active&&(this.active=void 0),[2]}}))}))},MediumLightboxCore.prototype.replace=function($img,opts){if(!isValidImage($img))throw new TypeError($img+" cannot be used as an image");if(this.active){this.active.$img.classList.remove(Classes.ORIGINAL_OPEN);var $oldLightbox=this.active.$lightbox,nextOpts=__assign({},this.options,$img.yamzOpts||{},opts||{}),nextActive=this.generateLightbox($img,nextOpts);this.active=__assign({},this.active,nextActive,{$lightbox:$oldLightbox,options:nextOpts}),this.replaceLightboxDOM(nextActive.$lightbox,$oldLightbox)}},MediumLightboxCore.prototype.replaceLightboxDOM=function($newLightbox,$oldLightbox){if($oldLightbox||($oldLightbox=this.active&&this.active.$lightbox),$oldLightbox){for(;$oldLightbox.firstChild;)$oldLightbox.removeChild($oldLightbox.firstChild);for(var $children=Array.from($newLightbox.children),i=0;i<$children.length;++i)$oldLightbox.appendChild($children[i]);$oldLightbox.setAttribute("class",$newLightbox.className)}},MediumLightboxCore.prototype.generateLightbox=function($img,opts){var _this=this,generator=opts.lightboxGenerator||this.defaultLightboxGenerator,origSrc=getSrcFromImage($img),hasSrcSet=$img instanceof HTMLPictureElement||$img.srcset;if(!opts.highres&&hasSrcSet){var highRes=getHighResFromImage($img);opts.highres=highRes}var $copiedImg=generateLightboxImg($img);$copiedImg.classList.add(Classes.IMG),$copiedImg.classList.remove(Classes.ORIGINAL),$img.classList.add(Classes.ORIGINAL_OPEN);var $lightbox=generator.call(this,$copiedImg,opts,$img),$highRes;return $lightbox.addEventListener("click",(function(){return _this.close()})),opts.highres&&(($highRes=new Image).decoding="async",$highRes.addEventListener("load",(function(){_this.active&&_this.active.$img===$img&&_this._highResLoaded($highRes)})),$highRes.addEventListener("error",(function(e){console.error("High-res image failed to load",e),$lightbox.classList.remove(Classes.HAS_HIGHRES);var $loader=$lightbox.querySelector("."+Classes.LOADER);$loader&&$loader.parentNode&&$loader.parentNode.removeChild($loader)})),$highRes.src=opts.highres,$highRes.classList.add(Classes.HIGHRES)),{$img:$img,$copiedImg:$copiedImg,$lightbox:$lightbox,origSrc:origSrc,$highRes:$highRes}},MediumLightboxCore.prototype._highResLoaded=function($highRes){var _this=this;if(this.active){var $copiedImg=this.active.$copiedImg,$animElm=$copiedImg.parentElement||$copiedImg,updater=function(){_this.active&&$copiedImg.parentElement&&(_this.active.$highRes=$highRes,_this.active.$lightbox.classList.add(Classes.HIGHRES_LOADED),$copiedImg.parentElement.insertBefore($highRes,$copiedImg.parentElement.firstChild))};this.state===STATES.Opening&&this._flip?this._flip.update($animElm,updater,this.active.options.duration):this.state===STATES.Open&&this.active?(this._flip=new FLIPElement(this.active.$img),this._flip.first(this.active.$copiedImg),updater(),this._flip.last(this.active.$copiedImg).invert($animElm).play(this.active.options.duration)):updater()}},MediumLightboxCore.prototype.optsFromElm=function($elm){var outp={};return $elm.dataset.class&&(outp.class=$elm.dataset.class),$elm.dataset.highres&&(outp.highres=$elm.dataset.highres),$elm.dataset.duration&&!Number.isNaN(+$elm.dataset.duration)&&(outp.duration=+$elm.dataset.duration),$elm.dataset.scrollAllowance&&!Number.isNaN(+$elm.dataset.scrollAllowance)&&(outp.scrollAllowance=+$elm.dataset.scrollAllowance),outp},MediumLightboxCore.prototype.bind=function($imgs,opts){var _this=this;"string"==typeof $imgs&&($imgs=Array.from(document.querySelectorAll($imgs))),$imgs instanceof Array||($imgs=[$imgs]),$imgs.forEach((function($img){$img.addEventListener("click",(function(){var imgOpts=__assign({},_this.optsFromElm($img),opts||{});_this.open($img,imgOpts)})),$img.classList.add(Classes.ORIGINAL),opts&&($img.yamzOpts=opts)}))},MediumLightboxCore.prototype.attachListeners=function(){window.addEventListener("scroll",this._onScroll),document.addEventListener("keydown",this._onKeyDown)},MediumLightboxCore.prototype.detachListeners=function(){window.removeEventListener("scroll",this._onScroll),document.removeEventListener("keydown",this._onKeyDown)},MediumLightboxCore.prototype._onScroll=function(){var _this=this;this._raf||(this._raf=!0,setTimeout((function(){_this._raf=!1,_this.onScroll()}),60))},MediumLightboxCore.prototype.onScroll=function(){if(this.active&&!(void 0===this.active.options.scrollAllowance||this.active.options.scrollAllowance<0)){var scrollAllowance=this.active.options.scrollAllowance,scrollPos=getScrollPosition(),delta;Math.abs(this.active.scrollPos-scrollPos)>scrollAllowance&&this.close()}},MediumLightboxCore.prototype._onKeyDown=function(e){this.onKeyDown(e)},MediumLightboxCore.prototype.onKeyDown=function(e){this.active&&"Escape"===e.key&&this.close()},MediumLightboxCore}()),css$1,css$2,css$3;function withCaption(_yamz){var defaultLightboxGenerator=_yamz.defaultLightboxGenerator,optsFromElm=_yamz.optsFromElm,yamz=_yamz;return yamz.defaultLightboxGenerator=function($copiedImg,opts,$original){var $lightbox=defaultLightboxGenerator.call(this,$copiedImg,opts,$original);if(opts.caption){var $caption=document.createElement("div");$caption.classList.add(Classes.CAPTION),opts.caption instanceof HTMLElement?$caption.appendChild(opts.caption):$caption.textContent=opts.caption,$lightbox.classList.add(Classes.HAS_CAPTION),$lightbox.appendChild($caption)}return $lightbox},yamz.optsFromElm=function($elm){var outp=optsFromElm.call(this,$elm);return $elm.dataset.caption&&(outp.caption=$elm.dataset.caption),outp},yamz}function withAlbum(_yamz){var defaultLightboxGenerator=_yamz.defaultLightboxGenerator,optsFromElm=_yamz.optsFromElm,onKeyDown=_yamz.onKeyDown,yamz=_yamz;function augmentLightbox(yamz,$lightbox,opts,index){if(!opts.album)return $lightbox;var prevIndex=opts.wrapAlbum?(opts.album.length+index-1)%opts.album.length:index-1,nextIndex=opts.wrapAlbum?(opts.album.length+index+1)%opts.album.length:index+1;if(prevIndex>=0){var $prev=document.createElement("button");$prev.classList.add(Classes.ALBUM_PREV),$prev.addEventListener("click",(function(e){opts.album&&(e.stopPropagation(),yamz.moveToAlbumEntry(opts.album[prevIndex],"prev"))})),$lightbox.appendChild($prev)}if(nextIndex<opts.album.length){var $next=document.createElement("button");$next.classList.add(Classes.ALBUM_NEXT),$next.addEventListener("click",(function(e){opts.album&&(e.stopPropagation(),yamz.moveToAlbumEntry(opts.album[nextIndex],"next"))})),$lightbox.appendChild($next)}}return yamz.options=__assign({wrapAlbum:!1},yamz.options),yamz.defaultLightboxGenerator=function($copiedImg,opts,$original){var $lightbox=defaultLightboxGenerator($copiedImg,opts,$original);if(opts.album){var index=opts.album.findIndex((function(entry){return entry.img===$original}));augmentLightbox(this,$lightbox,opts,index)}return $lightbox},yamz.optsFromElm=function($elm){var outp=optsFromElm($elm);if($elm.dataset.album){var $siblings=Array.from(document.querySelectorAll('[data-album="'+$elm.dataset.album+'"]'));outp.album=$siblings.map((function($sibling){return{img:$sibling,opts:optsFromElm($sibling)}})),outp.album.forEach((function(entry){entry.opts=__assign({},entry.opts||{},{album:outp.album})}))}return outp},yamz.moveToAlbumEntry=function(entry,direction){var _this=this;if(this.active){var $target=this.active.$lightbox.querySelector("."+Classes.IMG_WRAPPER);if(!$target)throw new ReferenceError("Could not find image wrapper in lightbox");var directions_out="next"===direction?"left":"right",directions_in="next"===direction?"right":"left",replaced=!1,_onAnimEnd=function(){if(!replaced&&_this.active){replaced=!0,_this.replace(entry.img,entry.opts);var $newTarget=_this.active.$lightbox.querySelector("."+Classes.IMG_WRAPPER);$newTarget&&$newTarget.classList.add(Classes.IMG_WRAPPER+"--in-"+directions_in)}};setTimeout(_onAnimEnd,1e3),$target.addEventListener("animationend",_onAnimEnd),$target.addEventListener("animationcancel",_onAnimEnd),$target.classList.add(Classes.IMG_WRAPPER+"--out-"+directions_out)}},yamz.onKeyDown=function(e){if(onKeyDown.call(this,e),this.active){var opts=this.active.options;if(opts.album&&("ArrowLeft"===e.key||"ArrowRight"===e.key)){var $curImg_1=this.active.$img,index=opts.album.findIndex((function(entry){return entry.img===$curImg_1})),prevIndex=opts.wrapAlbum?(opts.album.length+index-1)%opts.album.length:index-1,nextIndex=opts.wrapAlbum?(opts.album.length+index+1)%opts.album.length:index+1,targetIndex="ArrowLeft"===e.key?prevIndex:nextIndex;targetIndex>=0&&targetIndex<opts.album.length&&this.moveToAlbumEntry(opts.album[targetIndex],"ArrowLeft"===e.key?"prev":"next")}}},yamz}styleInject(".yamz__wrapper--has-caption .yamz__img-wrapper {\n    margin-bottom: 0;\n}\n.yamz__wrapper--has-caption .yamz__img-wrapper > img {\n    max-height: calc(100vh - 64px - 2em);\n}\n.yamz__caption {\n    margin: 1em 32px;\n    height: 1em;\n    will-change: opacity;\n\n    animation: yamz-fade-in 0.2s ease-out 0.1s both;\n}\n.yamz__wrapper--closing .yamz__caption {\n    opacity: 0 !important;\n}\n"),styleInject(".yamz__album__prev,\n.yamz__album__next {\n    box-sizing: border-box;\n    position: absolute;\n    z-index: -1;\n    height: 100%;\n    width: 350px;\n    max-width: 50%;\n    cursor: pointer;\n\n    opacity: 0.5;\n    background: none;\n    border: none;\n    padding: 0;\n    will-change: opacity;\n}\n.yamz__album__prev {\n    left: 0%;\n    background: linear-gradient(90deg, rgba(0, 0, 0, 0.25) 25%, rgba(0, 0, 0, 0)) !important;\n    animation: yamz-fade-in 0.2s both 0.2s;\n}\n.yamz__album__next {\n    right: 0;\n    background: linear-gradient(-90deg, rgba(0, 0, 0, 0.25) 25%, rgba(0, 0, 0, 0)) !important;\n    animation: yamz-fade-in 0.2s both 0.2s;\n}\n.yamz__album__prev::-moz-focus-inner,\n.yamz__album__next::-moz-focus-inner {\n    /* remove black outline in Firefox */\n    border: none;\n}\n.yamz__album__prev:hover,\n.yamz__album__prev:focus,\n.yamz__album__next:hover,\n.yamz__album__next:focus {\n    opacity: 1;\n}\n.yamz__wrapper--closing .yamz__album__prev,\n.yamz__wrapper--closing .yamz__album__next {\n    display: none;\n}\n\n.yamz__album__prev::before,\n.yamz__album__next::before {\n    content: \"\";\n    position: absolute;\n    width: 1.5em;\n    height: 1.5em;\n    top: 50%;\n    transform: translateY(-50%);\n    background-size: cover;\n}\n.yamz__album__prev::before {\n    left: 3em;\n    background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='white' d='M17.219 24a1.565 1.565 0 001.105-2.672L8.997 12l9.327-9.328A1.565 1.565 0 0016.111.459L5.677 10.893a1.565 1.565 0 000 2.213l10.435 10.435a1.56 1.56 0 001.107.459z'/%3E%3C/svg%3E\");\n}\n.yamz__album__next::before {\n    right: 3em;\n    background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='white' d='M6.783 24a1.565 1.565 0 01-1.106-2.672L15.004 12 5.676 2.671A1.565 1.565 0 017.889.458l10.435 10.435a1.565 1.565 0 010 2.213L7.889 23.541A1.56 1.56 0 016.783 24z'/%3E%3C/svg%3E\");\n}\n\n/* need each animation to have different names (not just use reverse direction) so animationend is called correctly */\n.yamz__img-wrapper--in-right {\n    animation: yamz-album-in-right 0.4s cubic-bezier(0.3, 0.3, 0.5, 1);\n}\n.yamz__img-wrapper--in-left {\n    animation: yamz-album-in-left 0.4s cubic-bezier(0.3, 0.3, 0.5, 1);\n}\n.yamz__img-wrapper--out-right {\n    animation: yamz-album-out-right 0.2s cubic-bezier(0.22, 0.61, 0.36, 1);\n}\n.yamz__img-wrapper--out-left {\n    animation: yamz-album-out-left 0.2s cubic-bezier(0.22, 0.61, 0.36, 1);\n}\n\n@keyframes yamz-album-out-right {\n    0% {\n        transform: scale(1) translate(0vw, 0px);\n        opacity: 1;\n    }\n    100% {\n        transform: scale(0.95) translate(5vw, 0px);\n        opacity: 0.25;\n    }\n}\n@keyframes yamz-album-out-left {\n    0% {\n        transform: scale(1) translate(0vw, 0px);\n        opacity: 1;\n    }\n    100% {\n        transform: scale(0.95) translate(-5vw, 0px);\n        opacity: 0.25;\n    }\n}\n\n@keyframes yamz-album-in-right {\n    0% {\n        transform: scale(0.95) translate(5vw, 0px);\n        opacity: 0.25;\n    }\n    100% {\n        transform: scale(1) translate(0vw, 0px);\n        opacity: 1;\n    }\n}\n@keyframes yamz-album-in-left {\n    0% {\n        transform: scale(0.95) translate(-5vw, 0px);\n        opacity: 0.25;\n    }\n    100% {\n        transform: scale(1) translate(0vw, 0px);\n        opacity: 1;\n    }\n}\n"),styleInject(".yamz__wrapper:not(.yamz__wrapper--closing) .yamz__img-wrapper--swiping {\n    transition: none !important;\n    will-change: transform;\n}\n");var SwipeDetector=function(){function SwipeDetector(listeners,threshold){void 0===threshold&&(threshold=0),this.listeners=listeners,this.threshold=threshold,this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this)}return SwipeDetector.prototype.setThreshold=function(threshold){this.threshold=threshold},SwipeDetector.prototype.start=function(e,metadata){if(!(e instanceof MouseEvent)&&e.touches.length>1)return this.cancel(),!1;var touch=e instanceof MouseEvent?e:e.touches[0],initialTouch={x:touch.clientX,y:touch.clientY,time:Date.now()};this.state={startTouch:__assign({},initialTouch),lastTouch:__assign({},initialTouch),isSwipe:!1,velocity:0,identifier:touch instanceof MouseEvent?void 0:touch.identifier,metadata:metadata},this.emit("start",initialTouch,metadata)},SwipeDetector.prototype.move=function(e){if(this.state){var touch=e instanceof MouseEvent?e:void 0;if(!(e instanceof MouseEvent))for(var i=0;i<e.changedTouches.length;++i){var t=e.changedTouches[i];if(t.identifier===this.state.identifier){touch=t;break}}if(touch){var timeDelta=Date.now()-this.state.lastTouch.time;if(!(timeDelta<16)){var xDelta=touch.clientX-this.state.startTouch.x,yDelta=touch.clientY-this.state.startTouch.y,absXDelta=Math.abs(xDelta),absYDelta=Math.abs(yDelta);if(0!==absXDelta||0!==absYDelta){this.state.lastTouch.x=touch.clientX,this.state.lastTouch.y=touch.clientY,this.state.lastTouch.time=Date.now(),this.state.velocity=timeDelta?(touch.clientX-this.state.lastTouch.x)/timeDelta:0;var IGNORE_THRESHOLD=32;if(!this.state.isSwipe){if(Math.max(absXDelta,absYDelta)<32)return;if(absYDelta>absXDelta)return void this.cancel();this.state.isSwipe=!0}e.preventDefault(),this.emit("update",{x:xDelta,y:yDelta},this.state.metadata)}}}}},SwipeDetector.prototype.end=function(e){if(!this.state)return!1;var touch=e instanceof MouseEvent?e:void 0;if(!(e instanceof MouseEvent))for(var i=0;i<e.changedTouches.length;++i){var t=e.changedTouches[i];if(t.identifier===this.state.identifier){touch=t;break}}if(!touch)return!1;var velocity=this.state.velocity,totalDelta=touch.clientX-this.state.startTouch.x,recentDelta=touch.clientX-this.state.lastTouch.x,finalDelta=totalDelta;return(totalDelta>=0&&recentDelta>=0||totalDelta<=0&&recentDelta<=0)&&(finalDelta+=50*velocity),this.threshold&&this.threshold>0&&Math.abs(finalDelta)>this.threshold?(this.emit("end",finalDelta<0?"left":"right",this.state.metadata),this.after(),!0):(this.cancel(),!1)},SwipeDetector.prototype.cancel=function(){this.state&&(this.emit("cancel",this.state.metadata),this.after())},SwipeDetector.prototype.after=function(){delete this.state},SwipeDetector.prototype.emit=function(event){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var listener=this.listeners[event];listener&&listener.apply(void 0,args)},SwipeDetector}(),index;function withSwipe(_yamz){var defaultLightboxGenerator=_yamz.defaultLightboxGenerator,yamz=_yamz;return"undefined"==typeof window?yamz:(yamz.options=__assign({swipeThreshold:.25*window.innerWidth,swipeResponseLimit:.05*window.innerWidth,swipeOnDesktop:!1},yamz.options),yamz.defaultLightboxGenerator=function($copiedImg,opts,$original){var _this=this,$lightbox=defaultLightboxGenerator.call(this,$copiedImg,opts,$original);if(!opts.album)return $lightbox;if(opts.swipeThreshold&&yamz.swipeDetector.setThreshold(opts.swipeThreshold),opts.swipeOnDesktop){$lightbox.addEventListener("mousedown",(function(e){e.preventDefault(),yamz.swipeDetector.start(e,opts)})),$lightbox.addEventListener("mousemove",(function(e){e.preventDefault(),yamz.swipeDetector.move(e)}));var justSwiped_1=0;$lightbox.addEventListener("mouseup",(function(e){e.preventDefault(),yamz.swipeDetector.state&&(justSwiped_1=yamz.swipeDetector.state.isSwipe?Date.now():0),yamz.swipeDetector.end(e)||_this.onSwipeCancel(opts)})),$lightbox.addEventListener("click",(function(e){Date.now()-justSwiped_1<16&&e.stopImmediatePropagation()}))}return $lightbox.addEventListener("touchstart",(function(e){yamz.swipeDetector.start(e,opts)})),$lightbox.addEventListener("touchmove",yamz.swipeDetector.move),$lightbox.addEventListener("touchend",yamz.swipeDetector.end),$lightbox.addEventListener("touchcancel",yamz.swipeDetector.cancel),$lightbox},yamz.applySwipeTransform=function(touchOffset,opts){if(this.active){var offset=Math.abs(touchOffset.x),scale=1;if(opts.swipeResponseLimit){var limit=1.5*opts.swipeResponseLimit,progress=Math.abs(touchOffset.x)/opts.swipeResponseLimit,clampedProgress=Math.min(progress,1.5),offsetScale=Math.sin(clampedProgress*Math.PI/3),linearOffset;offset=opts.swipeResponseLimit*offsetScale,progress>1&&(scale=Math.min(Math.max(1-.01*(progress-1),.8),1)),offset+=.05*(Math.abs(touchOffset.x)-Math.min(Math.abs(touchOffset.x),limit)),touchOffset.x<0&&(offset=-offset)}var $target=this.active.$lightbox.querySelector("."+Classes.IMG_WRAPPER);$target&&($target.style.transform="translateX("+offset.toFixed(5)+"px) scale("+scale.toFixed(5)+")",$target.style.opacity=""+(1-4*(1-scale)))}},yamz.onSwipeStart=function(point,opts){if(this.active){var $target=this.active.$lightbox.querySelector("."+Classes.IMG_WRAPPER);$target&&$target.classList.add(Classes.IMG_WRAPPER+"--swiping")}},yamz.onSwipeEnd=function(direction,opts){if(this.active){var $btn="left"===direction?this.active.$lightbox.querySelector("."+Classes.ALBUM_NEXT):this.active.$lightbox.querySelector("."+Classes.ALBUM_PREV);$btn&&$btn.click()}this.afterSwipe()},yamz.onSwipeCancel=function(opts){this.applySwipeTransform({x:0,y:0},opts),this.afterSwipe()},yamz.afterSwipe=function(){if(this.active){var $target=this.active.$lightbox.querySelector("."+Classes.IMG_WRAPPER);$target&&$target.classList.remove(Classes.IMG_WRAPPER+"--swiping")}},yamz.swipeDetector=new SwipeDetector({start:yamz.onSwipeStart.bind(yamz),update:yamz.applySwipeTransform.bind(yamz),end:yamz.onSwipeEnd.bind(yamz),cancel:yamz.onSwipeCancel.bind(yamz)}),yamz)}return withSwipe(withAlbum(withCaption(yamz)))}));